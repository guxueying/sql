create table uni_04mth_4g_tagof_stream as select 
UNI_04MTH_ALL_4G.	EPARCHY_CODE_201504	,
UNI_04MTH_ALL_4G.	USER_ID	,
UNI_04MTH_ALL_4G.	ID_1	,
UNI_04MTH_ALL_4G.	ID_2	,
UNI_04MTH_ALL_4G.	EPARCHY_TYPE_201504	,
UNI_04MTH_ALL_4G.	GROUP_TAG_201504	,
UNI_04MTH_ALL_4G.	ACTION_END_DATE_201504	,
UNI_04MTH_ALL_4G.	CREDIT_VALUE_201504	,
UNI_04MTH_ALL_4G.	JOIN_MONTH_201504	,
UNI_04MTH_ALL_4G.	ROAM_TAG_03_201504	,
UNI_04MTH_ALL_4G.	MTC_NUM_201504	,
UNI_04MTH_ALL_4G.	NO_LCALL_DURATION_201504	,
UNI_04MTH_ALL_4G.	PROV_LCALL_DURATION_201504	,
UNI_04MTH_ALL_4G.	NATIONAL_LCALL_DURATION_201504	,
UNI_04MTH_ALL_4G.	INTERGAT_LCALL_DURATION_201504	,
UNI_04MTH_ALL_4G.	NOINTERGATLCALLDURATION_201504	,
UNI_04MTH_ALL_4G.	ROAM_CALL_DURATION_201504	,
UNI_04MTH_ALL_4G.	BILL_DURATION_01_201504	,
UNI_04MTH_ALL_4G.	CZ_FEE_01_201504	,
UNI_04MTH_ALL_4G.	CUR_INCOME_201504	,
UNI_04MTH_ALL_4G.	PROM_FEE_201504	,
UNI_04MTH_ALL_4G.	DEBT_FEE_201504	,
UNI_04MTH_ALL_4G.	NOT_PACKAGE_USE_201504_201504	,
UNI_04MTH_ALL_4G.	FREE_FLOW_USE_201504	,
UNI_04MTH_ALL_4G.	ROAM_STREAM_01_201504	,
UNI_04MTH_ALL_4G.	ROAM_STREAM_02_201504	,
UNI_04MTH_ALL_4G.	ROAM_STREAM_04_201504	,
UNI_04MTH_ALL_4G.	VOICEOVER_TAG_201504	,
UNI_04MTH_ALL_4G.	SMS_NUMS_201504	,
UNI_04MTH_ALL_4G.	USER_STATE_CODESET_20150430	,
UNI_04MTH_ALL_4G.	USER_STATE_CODESET_20150415	,
UNI_04MTH_ALL_4G.	USER_STATE_CODESET_20150331	,
ASIAINFO_MON_QX_4_4G.	LOST_TAG_201501	,
ASIAINFO_MON_QX_4_4G.	LOST_TAG_201502	,
ASIAINFO_MON_QX_4_4G.	LOST_TAG_201503	,
ASIAINFO_MON_QX_4_4G.	LOST_TAG_201504	,
ASIAINFO_MON_QX_4_4G.	LOST_TAG_201505	,
ASIAINFO_MON_QX_4_4G.	LOST_TAG_201506	,
ASIAINFO_MON_QX_4_4G.	LOST_TAG_201507	,
ASIAINFO_MON_QX_4_4G.	joIN_MONTH_201501	,
A_4G_4.	TOTAL_STREAM_01	,
A_4G_4.	TOTAL_STREAM_02	,
A_4G_4.	TOTAL_STREAM_03	,
A_4G_4.	TOTAL_STREAM_04	,
A_4G_4.	TOTAL_STREAM_05	,
ASIAINFO_TOTALUSESTREAM_QX4_4G.	TOTAL_USE_STREAM_20150601	,
ASIAINFO_TOTALUSESTREAM_QX4_4G.	TOTAL_USE_STREAM_20150602	,
ASIAINFO_TOTALUSESTREAM_QX4_4G.	TOTAL_USE_STREAM_20150603	,
ASIAINFO_TOTALUSESTREAM_QX4_4G.	TOTAL_USE_STREAM_20150604	,
ASIAINFO_TOTALUSESTREAM_QX4_4G.	TOTAL_USE_STREAM_20150605	,
ASIAINFO_TOTALUSESTREAM_QX4_4G.	TOTAL_USE_STREAM_20150606	,
ASIAINFO_TOTALUSESTREAM_QX4_4G.	TOTAL_USE_STREAM_20150607	,
ASIAINFO_TOTALUSESTREAM_QX4_4G.	TOTAL_USE_STREAM_20150608	,
ASIAINFO_TOTALUSESTREAM_QX4_4G.	TOTAL_USE_STREAM_20150609	,
ASIAINFO_TOTALUSESTREAM_QX4_4G.	TOTAL_USE_STREAM_20150610	,
ASIAINFO_TOTALUSESTREAM_QX4_4G.	TOTAL_USE_STREAM_20150611	,
ASIAINFO_TOTALUSESTREAM_QX4_4G.	TOTAL_USE_STREAM_20150612	,
ASIAINFO_TOTALUSESTREAM_QX4_4G.	TOTAL_USE_STREAM_20150613	,
ASIAINFO_TOTALUSESTREAM_QX4_4G.	TOTAL_USE_STREAM_20150614	,
ASIAINFO_TOTALUSESTREAM_QX4_4G.	TOTAL_USE_STREAM_20150615	,
ASIAINFO_TOTALUSESTREAM_QX4_4G.	TOTAL_USE_STREAM_20150616	,
ASIAINFO_TOTALUSESTREAM_QX4_4G.	TOTAL_USE_STREAM_20150617	,
ASIAINFO_TOTALUSESTREAM_QX4_4G.	TOTAL_USE_STREAM_20150618	,
ASIAINFO_TOTALUSESTREAM_QX4_4G.	TOTAL_USE_STREAM_20150619	,
ASIAINFO_TOTALUSESTREAM_QX4_4G.	TOTAL_USE_STREAM_20150620	,
ASIAINFO_TOTALUSESTREAM_QX4_4G.	TOTAL_USE_STREAM_20150621	,
ASIAINFO_TOTALUSESTREAM_QX4_4G.	TOTAL_USE_STREAM_20150622	,
ASIAINFO_TOTALUSESTREAM_QX4_4G.	TOTAL_USE_STREAM_20150623	,
ASIAINFO_TOTALUSESTREAM_QX4_4G.	TOTAL_USE_STREAM_20150624	,
ASIAINFO_TOTALUSESTREAM_QX4_4G.	TOTAL_USE_STREAM_20150625	,
ASIAINFO_TOTALUSESTREAM_QX4_4G.	TOTAL_USE_STREAM_20150626	,
ASIAINFO_TOTALUSESTREAM_QX4_4G.	TOTAL_USE_STREAM_20150627	,
ASIAINFO_TOTALUSESTREAM_QX4_4G.	TOTAL_USE_STREAM_20150628	,
ASIAINFO_TOTALUSESTREAM_QX4_4G.	TOTAL_USE_STREAM_20150629	
from UNI_04MTH_ALL_4G,ASIAINFO_MON_QX_4_4G,A_4G_4,ASIAINFO_TOTALUSESTREAM_QX4_4G
where ASIAINFO_TOTALUSESTREAM_QX4_4G.user_id=A_4G_4.user_id and A_4G_4.user_id=ASIAINFO_MON_QX_4_4G.user_id and
ASIAINFO_MON_QX_4_4G.user_id=UNI_04MTH_ALL_4G.user_id;

alter table UNI_04MTH_4G_TAGOF_STREAM add total_stream_06 number;
update UNI_04MTH_4G_TAGOF_STREAM set total_stream_06=
TOTAL_USE_STREAM_20150601	+
TOTAL_USE_STREAM_20150602	+
TOTAL_USE_STREAM_20150603	+
TOTAL_USE_STREAM_20150604	+
TOTAL_USE_STREAM_20150605	+
TOTAL_USE_STREAM_20150606	+
TOTAL_USE_STREAM_20150607	+
TOTAL_USE_STREAM_20150608	+
TOTAL_USE_STREAM_20150609	+
TOTAL_USE_STREAM_20150610	+
TOTAL_USE_STREAM_20150611	+
TOTAL_USE_STREAM_20150612	+
TOTAL_USE_STREAM_20150613	+
TOTAL_USE_STREAM_20150614	+
TOTAL_USE_STREAM_20150615	+
TOTAL_USE_STREAM_20150616	+
TOTAL_USE_STREAM_20150617	+
TOTAL_USE_STREAM_20150618	+
TOTAL_USE_STREAM_20150619	+
TOTAL_USE_STREAM_20150620	+
TOTAL_USE_STREAM_20150621	+
TOTAL_USE_STREAM_20150622	+
TOTAL_USE_STREAM_20150623	+
TOTAL_USE_STREAM_20150624	+
TOTAL_USE_STREAM_20150625	+
TOTAL_USE_STREAM_20150626	+
TOTAL_USE_STREAM_20150627	+
TOTAL_USE_STREAM_20150628	+
TOTAL_USE_STREAM_20150629	;

alter table UNI_04MTH_4G_TAGOF_STREAM add lost_tag_4_t3_4g number;
update UNI_04MTH_4G_TAGOF_STREAM set lost_tag_4_t3_4g=-1;
update UNI_04MTH_4G_TAGOF_STREAM set lost_tag_4_t3_4g=0 where
(LOST_TAG_201502=0 and 
LOST_TAG_201503=0 and 
LOST_TAG_201504=0 and 
LOST_TAG_201505=0 and 
LOST_TAG_201506=0 and 
LOST_TAG_201507=0 and 
LOST_TAG_201501=0) or 
(LOST_TAG_201502=0 and 
LOST_TAG_201503=0 and 
LOST_TAG_201504=0 and 
LOST_TAG_201505=0 and 
LOST_TAG_201506=0 and 
LOST_TAG_201507=0 and 
LOST_TAG_201501=2) or 
(LOST_TAG_201502=2 and 
LOST_TAG_201503=0 and 
LOST_TAG_201504=0 and 
LOST_TAG_201505=0 and 
LOST_TAG_201506=0 and 
LOST_TAG_201507=0 and 
LOST_TAG_201501=2) or 
(LOST_TAG_201502=2 and 
LOST_TAG_201503=2 and 
LOST_TAG_201504=0 and 
LOST_TAG_201505=0 and 
LOST_TAG_201506=0 and 
LOST_TAG_201507=0 and 
LOST_TAG_201501=2);
update UNI_04MTH_4G_TAGOF_STREAM set lost_tag_4_t3_4g=1 where
(LOST_TAG_201502=0 and 
LOST_TAG_201503=0 and 
LOST_TAG_201504=0 and 
LOST_TAG_201505=0 and 
LOST_TAG_201506=0 and 
LOST_TAG_201501=0 and 
LOST_TAG_201507=1) or 
(LOST_TAG_201501=2 and 
LOST_TAG_201503=0 and 
LOST_TAG_201504=0 and 
LOST_TAG_201505=0 and 
LOST_TAG_201506=0 and 
LOST_TAG_201502=0 and 
LOST_TAG_201507=1) or 
(LOST_TAG_201502=2 and 
LOST_TAG_201501=2 and 
LOST_TAG_201504=0 and 
LOST_TAG_201505=0 and 
LOST_TAG_201506=0 and 
LOST_TAG_201503=0 and 
LOST_TAG_201507=1) or 
(LOST_TAG_201502=2 and 
LOST_TAG_201503=2 and 
LOST_TAG_201501=2 and 
LOST_TAG_201505=0 and 
LOST_TAG_201506=0 and 
LOST_TAG_201504=0 and 
LOST_TAG_201507=1);

alter table UNI_04MTH_4G_TAGOF_STREAM add tagof_stream number;
update UNI_04MTH_4G_TAGOF_STREAM set tagof_stream=0;
update UNI_04MTH_4G_TAGOF_STREAM set tagof_stream=1
where
join_month_201501>=0 and
(case when total_stream_01=0 then 1 else 0 end +
case when total_stream_02=0 then 1 else 0 end +
case when total_stream_03=0 then 1 else 0 end +
case when total_stream_04=0 then 1 else 0 end +
case when total_stream_05=0 then 1 else 0 end +
case when total_stream_06=0 then 1 else 0 end)>=4;

create table yuanshishuju_4g_4_stream as select
to_number(EPARCHY_CODE_201504) as EPARCHY_CODE_201504
,to_number(USER_ID) as USER_ID
,to_number(ID_1) as ID_1
,to_number(ID_2) as ID_2
,to_number(EPARCHY_TYPE_201504) as EPARCHY_TYPE_201504
,to_number(GROUP_TAG_201504) as GROUP_TAG_201504
,to_number(ACTION_END_DATE_201504) as ACTION_END_DATE_201504
,to_number(CREDIT_VALUE_201504) as CREDIT_VALUE_201504
,to_number(JOIN_MONTH_201504) as JOIN_MONTH_201504
,to_number(ROAM_TAG_03_201504) as ROAM_TAG_03_201504
,to_number(MTC_NUM_201504) as MTC_NUM_201504
,to_number(NO_LCALL_DURATION_201504) as NO_LCALL_DURATION_201504
,to_number(PROV_LCALL_DURATION_201504) as PROV_LCALL_DURATION_201504
,to_number(NATIONAL_LCALL_DURATION_201504) as NATIONAL_LCALL_DURATION_201504
,to_number(INTERGAT_LCALL_DURATION_201504) as INTERGAT_LCALL_DURATION_201504
,to_number(NOINTERGATLCALLDURATION_201504) as NOINTERGATLCALLDURATION_201504
,to_number(ROAM_CALL_DURATION_201504) as ROAM_CALL_DURATION_201504
,to_number(BILL_DURATION_01_201504) as BILL_DURATION_01_201504
,to_number(CZ_FEE_01_201504) as CZ_FEE_01_201504
,to_number(CUR_INCOME_201504) as CUR_INCOME_201504
,to_number(PROM_FEE_201504) as PROM_FEE_201504
,to_number(DEBT_FEE_201504) as DEBT_FEE_201504
,to_number(NOT_PACKAGE_USE_201504_201504) as NOT_PACKAGE_USE_201504_201504
,to_number(FREE_FLOW_USE_201504) as FREE_FLOW_USE_201504
,to_number(ROAM_STREAM_01_201504) as ROAM_STREAM_01_201504
,to_number(ROAM_STREAM_02_201504) as ROAM_STREAM_02_201504
,to_number(ROAM_STREAM_04_201504) as ROAM_STREAM_04_201504
,to_number(VOICEOVER_TAG_201504) as VOICEOVER_TAG_201504
,to_number(SMS_NUMS_201504) as SMS_NUMS_201504
,to_number(USER_STATE_CODESET_20150430) as USER_STATE_CODESET_20150430
,to_number(USER_STATE_CODESET_20150415) as USER_STATE_CODESET_20150415
,to_number(USER_STATE_CODESET_20150331) as USER_STATE_CODESET_20150331
,to_number(tagof_stream) as tagof_stream 
from UNI_04MTH_4G_TAGOF_STREAM
where lost_tag_4_t3_4g!=-1;


create table uni_05mth_4g_tagof_stream as (select	
ASIAINFO_MON_QX_5_4G.	EPARCHY_CODE_201505,
	ASIAINFO_MON_QX_5_4G.USER_ID,
	(ASIAINFO_MON_QX_5_4G.USER_ID-mod(ASIAINFO_MON_QX_5_4G.USER_ID,10))/10 as ID_1,
	mod(ASIAINFO_MON_QX_5_4G.USER_ID,10) as ID_2,
ASIAINFO_MON_QX_5_4G.	EPARCHY_TYPE_201505,
ASIAINFO_MON_QX_5_4G.	ACTION_END_DATE_201505,
ASIAINFO_MON_QX_5_4G.	CREDIT_VALUE_201505,
ASIAINFO_MON_QX_5_4G.	JOIN_MONTH_201505,
ASIAINFO_MON_QX_5_4G.	VOICE_TAG_201505,
ASIAINFO_MON_QX_5_4G.	ROAM_TAG_03_201505,
ASIAINFO_MON_QX_5_4G.	MTC_NUM_201505,
ASIAINFO_MON_QX_5_4G.	NO_LCALL_DURATION_201505,
ASIAINFO_MON_QX_5_4G.	PROV_LCALL_DURATION_201505,
ASIAINFO_MON_QX_5_4G.	NATIONAL_LCALL_DURATION_201505,
ASIAINFO_MON_QX_5_4G.	INTERGAT_LCALL_DURATION_201505,
ASIAINFO_MON_QX_5_4G.	NOINTERGATLCALLDURATION_201505,
ASIAINFO_MON_QX_5_4G.	ROAM_CALL_DURATION_201505,
ASIAINFO_MON_QX_5_4G.	BILL_DURATION_01_201505,
ASIAINFO_MON_QX_5_4G.	CZ_FEE_01_201505,
ASIAINFO_MON_QX_5_4G.	CUR_INCOME_201505,
ASIAINFO_MON_QX_5_4G.	PROM_FEE_201505,
ASIAINFO_MON_QX_5_4G.	DEBT_FEE_201505,
ASIAINFO_MON_QX_5_4G.	NOT_PACKAGE_USE_201505_201505,
ASIAINFO_MON_QX_5_4G.	FREE_FLOW_USE_201505,
ASIAINFO_MON_QX_5_4G.	ROAM_STREAM_01_201505,
ASIAINFO_MON_QX_5_4G.	ROAM_STREAM_02_201505,
ASIAINFO_MON_QX_5_4G.	ROAM_STREAM_04_201505,
ASIAINFO_MON_QX_5_4G.	VOICEOVER_TAG_201505,
ASIAINFO_MON_QX_5_4G.	SMS_NUMS_201505,
ASIAINFO_MON_QX_5_4G.	LOST_TAG_201502,
ASIAINFO_MON_QX_5_4G.	LOST_TAG_201503,
ASIAINFO_MON_QX_5_4G.	LOST_TAG_201504,
ASIAINFO_MON_QX_5_4G.	LOST_TAG_201505,
ASIAINFO_MON_QX_5_4G.	LOST_TAG_201506,
ASIAINFO_MON_QX_5_4G.	LOST_TAG_201507,
ASIAINFO_MON_QX_5_4G.	LOST_TAG_201508,
ASIAINFO_USERSTCODESET_QX_5_4G.	USER_STATE_CODESET_20150531,
ASIAINFO_USERSTCODESET_QX_5_4G.	USER_STATE_CODESET_20150515,
ASIAINFO_USERSTCODESET_QX_5_4G.	USER_STATE_CODESET_20150430,
ASIAINFO_MON_QX_5_4G.JOIN_MONTH_201502,
uni_04mth_4g_tagof_stream.	TOTAL_STREAM_02,
uni_04mth_4g_tagof_stream.	TOTAL_STREAM_03,
uni_04mth_4g_tagof_stream.	TOTAL_STREAM_04,
uni_04mth_4g_tagof_stream.	TOTAL_STREAM_05,
uni_04mth_4g_tagof_stream.	TOTAL_STREAM_06,
ASIAINFO_TOTALUSESTREAM_QX5_4G.	 TOTAL_USE_STREAM_20150701 ,
ASIAINFO_TOTALUSESTREAM_QX5_4G.	 TOTAL_USE_STREAM_20150702 ,
ASIAINFO_TOTALUSESTREAM_QX5_4G.	 TOTAL_USE_STREAM_20150703 ,
ASIAINFO_TOTALUSESTREAM_QX5_4G.	 TOTAL_USE_STREAM_20150704 ,
ASIAINFO_TOTALUSESTREAM_QX5_4G.	 TOTAL_USE_STREAM_20150705 ,
ASIAINFO_TOTALUSESTREAM_QX5_4G.	 TOTAL_USE_STREAM_20150706 ,
ASIAINFO_TOTALUSESTREAM_QX5_4G.	 TOTAL_USE_STREAM_20150707 ,
ASIAINFO_TOTALUSESTREAM_QX5_4G.	 TOTAL_USE_STREAM_20150708 ,
ASIAINFO_TOTALUSESTREAM_QX5_4G.	 TOTAL_USE_STREAM_20150709 ,
ASIAINFO_TOTALUSESTREAM_QX5_4G.	 TOTAL_USE_STREAM_20150710 ,
ASIAINFO_TOTALUSESTREAM_QX5_4G.	 TOTAL_USE_STREAM_20150711 ,
ASIAINFO_TOTALUSESTREAM_QX5_4G.	 TOTAL_USE_STREAM_20150712 ,
ASIAINFO_TOTALUSESTREAM_QX5_4G.	 TOTAL_USE_STREAM_20150713 ,
ASIAINFO_TOTALUSESTREAM_QX5_4G.	 TOTAL_USE_STREAM_20150714 ,
ASIAINFO_TOTALUSESTREAM_QX5_4G.	 TOTAL_USE_STREAM_20150715 ,
ASIAINFO_TOTALUSESTREAM_QX5_4G.	 TOTAL_USE_STREAM_20150716 ,
ASIAINFO_TOTALUSESTREAM_QX5_4G.	 TOTAL_USE_STREAM_20150717 ,
ASIAINFO_TOTALUSESTREAM_QX5_4G.	 TOTAL_USE_STREAM_20150718 ,
ASIAINFO_TOTALUSESTREAM_QX5_4G.	 TOTAL_USE_STREAM_20150719 ,
ASIAINFO_TOTALUSESTREAM_QX5_4G.	 TOTAL_USE_STREAM_20150720 ,
ASIAINFO_TOTALUSESTREAM_QX5_4G.	 TOTAL_USE_STREAM_20150721 ,
ASIAINFO_TOTALUSESTREAM_QX5_4G.	 TOTAL_USE_STREAM_20150722 ,
ASIAINFO_TOTALUSESTREAM_QX5_4G.	 TOTAL_USE_STREAM_20150723 ,
ASIAINFO_TOTALUSESTREAM_QX5_4G.	 TOTAL_USE_STREAM_20150724 ,
ASIAINFO_TOTALUSESTREAM_QX5_4G.	 TOTAL_USE_STREAM_20150725 ,
ASIAINFO_TOTALUSESTREAM_QX5_4G.	 TOTAL_USE_STREAM_20150726 ,
ASIAINFO_TOTALUSESTREAM_QX5_4G.	 TOTAL_USE_STREAM_20150727 ,
ASIAINFO_TOTALUSESTREAM_QX5_4G.	 TOTAL_USE_STREAM_20150728 ,
ASIAINFO_TOTALUSESTREAM_QX5_4G.	 TOTAL_USE_STREAM_20150729 ,
ASIAINFO_TOTALUSESTREAM_QX5_4G.	 TOTAL_USE_STREAM_20150730 ,
ASIAINFO_TOTALUSESTREAM_QX5_4G.	 TOTAL_USE_STREAM_20150731 
from ASIAINFO_TOTALUSESTREAM_QX5_4G,uni_04mth_4g_tagof_stream,ASIAINFO_MON_QX_5_4G,ASIAINFO_USERSTCODESET_QX_5_4G
where ASIAINFO_TOTALUSESTREAM_QX5_4G.user_id=uni_04mth_4g_tagof_stream.user_id and uni_04mth_4g_tagof_stream.user_id=ASIAINFO_MON_QX_5_4G.user_id
and ASIAINFO_MON_QX_5_4G.user_id=ASIAINFO_USERSTCODESET_QX_5_4G.user_id);
