create table uni_05mth_4g_tagof_stream_t2 as select 
EPARCHY_CODE_201505,
uni_05mth_4g_tagof_stream.USER_ID,
uni_05mth_4g_tagof_stream.ID_1,
ID_2,
EPARCHY_TYPE_201505,
ACTION_END_DATE_201505	,
CREDIT_VALUE_201505	,
JOIN_MONTH_201505	,
VOICE_TAG_201505	,
ROAM_TAG_03_201505	,
MTC_NUM_201505	,
NO_LCALL_DURATION_201505	,
PROV_LCALL_DURATION_201505	,
NATIONAL_LCALL_DURATION_201505	,
INTERGAT_LCALL_DURATION_201505	,
NOINTERGATLCALLDURATION_201505	,
ROAM_CALL_DURATION_201505	,
BILL_DURATION_01_201505	,
CZ_FEE_01_201505	,
CUR_INCOME_201505	,
PROM_FEE_201505	,
DEBT_FEE_201505	,
NOT_PACKAGE_USE_201505_201505	,
FREE_FLOW_USE_201505	,
ROAM_STREAM_01_201505	,
ROAM_STREAM_02_201505	,
ROAM_STREAM_04_201505	,
VOICEOVER_TAG_201505	,
SMS_NUMS_201505	,
ASIAINFO_USERSTCODESET_QX_4_4G.USER_STATE_CODESET_20150531,
ASIAINFO_USERSTCODESET_QX_4_4G.USER_STATE_CODESET_20150515,
ASIAINFO_USERSTCODESET_QX_4_4G.USER_STATE_CODESET_20150430,
LOST_TAG_201502,
LOST_TAG_201503,
LOST_TAG_201504,
LOST_TAG_201505,
LOST_TAG_201506,
LOST_TAG_201507,
join_month_201502,
total_stream_02,
total_stream_03,
total_stream_04,
total_stream_05
from uni_05mth_4g_tagof_stream,ASIAINFO_USERSTCODESET_QX_4_4G
where uni_05mth_4g_tagof_stream.user_id=ASIAINFO_USERSTCODESET_QX_4_4G.user_id;

alter table uni_05mth_4g_tagof_stream_t2 add lost_tag_5_t2 number;
update uni_05mth_4g_tagof_stream_t2 set lost_tag_5_t2=-1;
update uni_05mth_4g_tagof_stream_t2 set lost_tag_5_t2=0 where
(LOST_TAG_201502=0 and 
LOST_TAG_201503=0 and 
LOST_TAG_201504=0 and 
LOST_TAG_201505=0 and 
LOST_TAG_201506=0 and 
LOST_TAG_201507=0) or 
(LOST_TAG_201502=2 and 
LOST_TAG_201503=0 and 
LOST_TAG_201504=0 and 
LOST_TAG_201505=0 and 
LOST_TAG_201506=0 and 
LOST_TAG_201507=0 )or 
(LOST_TAG_201502=2 and 
LOST_TAG_201503=2 and 
LOST_TAG_201504=0 and 
LOST_TAG_201505=0 and 
LOST_TAG_201506=0 and 
LOST_TAG_201507=0 )or 
(LOST_TAG_201502=2 and 
LOST_TAG_201503=2 and 
LOST_TAG_201504=2 and 
LOST_TAG_201505=0 and 
LOST_TAG_201506=0 and 
LOST_TAG_201507=0);
update uni_05mth_4g_tagof_stream_t2 set lost_tag_5_t2=1 where
(LOST_TAG_201502=0 and 
LOST_TAG_201503=0 and 
LOST_TAG_201504=0 and 
LOST_TAG_201505=0 and 
LOST_TAG_201506=0 and 
LOST_TAG_201507=1) or 
(LOST_TAG_201502=2 and 
LOST_TAG_201503=0 and 
LOST_TAG_201504=0 and 
LOST_TAG_201505=0 and 
LOST_TAG_201506=0 and 
LOST_TAG_201507=1 )or 
(LOST_TAG_201502=2 and 
LOST_TAG_201503=2 and 
LOST_TAG_201504=0 and 
LOST_TAG_201505=0 and 
LOST_TAG_201506=0 and 
LOST_TAG_201507=1 )or 
(LOST_TAG_201502=2 and 
LOST_TAG_201503=2 and 
LOST_TAG_201504=2 and 
LOST_TAG_201505=0 and 
LOST_TAG_201506=0 and 
LOST_TAG_201507=1);
 
alter table uni_05mth_4g_tagof_stream_t2 add tagof_stream number;
update uni_05mth_4g_tagof_stream_t2 set tagof_stream=0;
update uni_05mth_4g_tagof_stream_t2 set tagof_stream=1
where 
join_month_201502>=0 and
(case when total_stream_05=0 then 1 else 0 end +
case when total_stream_02=0 then 1 else 0 end +
case when total_stream_03=0 then 1 else 0 end +
case when total_stream_04=0 then 1 else 0 end )>=2;

select count(*)lost_tag_5_t2 from  uni_05mth_4g_tagof_stream_t2 where
tagof_stream=1 group by lost_tag_5_t2;

update uni_05mth_4g_tagof_stream_t2 set USER_STATE_CODESET_20150531='3' where USER_STATE_CODESET_20150531='2';
update uni_05mth_4g_tagof_stream_t2 set USER_STATE_CODESET_20150531='2' where USER_STATE_CODESET_20150531='4';
update uni_05mth_4g_tagof_stream_t2 set USER_STATE_CODESET_20150531='4' where USER_STATE_CODESET_20150531='6';
update uni_05mth_4g_tagof_stream_t2 set USER_STATE_CODESET_20150531='7' where USER_STATE_CODESET_20150531='7';
update uni_05mth_4g_tagof_stream_t2 set USER_STATE_CODESET_20150531='5' where USER_STATE_CODESET_20150531='5';
update uni_05mth_4g_tagof_stream_t2 set USER_STATE_CODESET_20150531='6' where USER_STATE_CODESET_20150531='9';
update uni_05mth_4g_tagof_stream_t2 set USER_STATE_CODESET_20150531='2' where USER_STATE_CODESET_20150531='A';
update uni_05mth_4g_tagof_stream_t2 set USER_STATE_CODESET_20150531='3' where USER_STATE_CODESET_20150531='B';
update uni_05mth_4g_tagof_stream_t2 set USER_STATE_CODESET_20150531='4' where USER_STATE_CODESET_20150531='F';
update uni_05mth_4g_tagof_stream_t2 set USER_STATE_CODESET_20150531='2' where USER_STATE_CODESET_20150531='K';
update uni_05mth_4g_tagof_stream_t2 set USER_STATE_CODESET_20150531='5' where USER_STATE_CODESET_20150531='N';
update uni_05mth_4g_tagof_stream_t2 set USER_STATE_CODESET_20150531='5' where USER_STATE_CODESET_20150531='O';
update uni_05mth_4g_tagof_stream_t2 set USER_STATE_CODESET_20150531='5' where USER_STATE_CODESET_20150531='T';
update uni_05mth_4g_tagof_stream_t2 set USER_STATE_CODESET_20150531='6' where USER_STATE_CODESET_20150531='U';
update uni_05mth_4g_tagof_stream_t2 set USER_STATE_CODESET_20150531='5' where USER_STATE_CODESET_20150531='X';
update uni_05mth_4g_tagof_stream_t2 set USER_STATE_CODESET_20150531='5' where USER_STATE_CODESET_20150531='M';

update uni_05mth_4g_tagof_stream_t2 set USER_STATE_CODESET_20150515='3' where USER_STATE_CODESET_20150515='2';
update uni_05mth_4g_tagof_stream_t2 set USER_STATE_CODESET_20150515='2' where USER_STATE_CODESET_20150515='4';
update uni_05mth_4g_tagof_stream_t2 set USER_STATE_CODESET_20150515='4' where USER_STATE_CODESET_20150515='6';
update uni_05mth_4g_tagof_stream_t2 set USER_STATE_CODESET_20150515='7' where USER_STATE_CODESET_20150515='7';
update uni_05mth_4g_tagof_stream_t2 set USER_STATE_CODESET_20150515='5' where USER_STATE_CODESET_20150515='5';
update uni_05mth_4g_tagof_stream_t2 set USER_STATE_CODESET_20150515='6' where USER_STATE_CODESET_20150515='9';
update uni_05mth_4g_tagof_stream_t2 set USER_STATE_CODESET_20150515='2' where USER_STATE_CODESET_20150515='A';
update uni_05mth_4g_tagof_stream_t2 set USER_STATE_CODESET_20150515='3' where USER_STATE_CODESET_20150515='B';
update uni_05mth_4g_tagof_stream_t2 set USER_STATE_CODESET_20150515='4' where USER_STATE_CODESET_20150515='F';
update uni_05mth_4g_tagof_stream_t2 set USER_STATE_CODESET_20150515='2' where USER_STATE_CODESET_20150515='K';
update uni_05mth_4g_tagof_stream_t2 set USER_STATE_CODESET_20150515='5' where USER_STATE_CODESET_20150515='N';
update uni_05mth_4g_tagof_stream_t2 set USER_STATE_CODESET_20150515='5' where USER_STATE_CODESET_20150515='O';
update uni_05mth_4g_tagof_stream_t2 set USER_STATE_CODESET_20150515='5' where USER_STATE_CODESET_20150515='T';
update uni_05mth_4g_tagof_stream_t2 set USER_STATE_CODESET_20150515='6' where USER_STATE_CODESET_20150515='U';
update uni_05mth_4g_tagof_stream_t2 set USER_STATE_CODESET_20150515='5' where USER_STATE_CODESET_20150515='X';
update uni_05mth_4g_tagof_stream_t2 set USER_STATE_CODESET_20150515='5' where USER_STATE_CODESET_20150515='M';

update uni_05mth_4g_tagof_stream_t2 set USER_STATE_CODESET_20150430='3' where USER_STATE_CODESET_20150430='2';
update uni_05mth_4g_tagof_stream_t2 set USER_STATE_CODESET_20150430='2' where USER_STATE_CODESET_20150430='4';
update uni_05mth_4g_tagof_stream_t2 set USER_STATE_CODESET_20150430='4' where USER_STATE_CODESET_20150430='6';
update uni_05mth_4g_tagof_stream_t2 set USER_STATE_CODESET_20150430='7' where USER_STATE_CODESET_20150430='7';
update uni_05mth_4g_tagof_stream_t2 set USER_STATE_CODESET_20150430='5' where USER_STATE_CODESET_20150430='5';
update uni_05mth_4g_tagof_stream_t2 set USER_STATE_CODESET_20150430='6' where USER_STATE_CODESET_20150430='9';
update uni_05mth_4g_tagof_stream_t2 set USER_STATE_CODESET_20150430='2' where USER_STATE_CODESET_20150430='A';
update uni_05mth_4g_tagof_stream_t2 set USER_STATE_CODESET_20150430='3' where USER_STATE_CODESET_20150430='B';
update uni_05mth_4g_tagof_stream_t2 set USER_STATE_CODESET_20150430='4' where USER_STATE_CODESET_20150430='F';
update uni_05mth_4g_tagof_stream_t2 set USER_STATE_CODESET_20150430='2' where USER_STATE_CODESET_20150430='K';
update uni_05mth_4g_tagof_stream_t2 set USER_STATE_CODESET_20150430='5' where USER_STATE_CODESET_20150430='N';
update uni_05mth_4g_tagof_stream_t2 set USER_STATE_CODESET_20150430='5' where USER_STATE_CODESET_20150430='O';
update uni_05mth_4g_tagof_stream_t2 set USER_STATE_CODESET_20150430='5' where USER_STATE_CODESET_20150430='T';
update uni_05mth_4g_tagof_stream_t2 set USER_STATE_CODESET_20150430='6' where USER_STATE_CODESET_20150430='U';
update uni_05mth_4g_tagof_stream_t2 set USER_STATE_CODESET_20150430='5' where USER_STATE_CODESET_20150430='X';
update uni_05mth_4g_tagof_stream_t2 set USER_STATE_CODESET_20150430='5' where USER_STATE_CODESET_20150430='M';

create table yuanshishuju_4g_5_stream_t2 as (select
to_number(EPARCHY_CODE_201505) as EPARCHY_CODE_201505
,to_number(USER_ID) as USER_ID
,to_number(ID_1) as ID_1
,to_number(ID_2) as ID_2
,to_number(EPARCHY_TYPE_201505) as EPARCHY_TYPE_201505
,to_number(ACTION_END_DATE_201505) as ACTION_END_DATE_201505
,to_number(CREDIT_VALUE_201505) as CREDIT_VALUE_201505
,to_number(JOIN_MONTH_201505) as JOIN_MONTH_201505
,to_number(ROAM_TAG_03_201505) as ROAM_TAG_03_201505
,to_number(MTC_NUM_201505) as MTC_NUM_201505
,to_number(NO_LCALL_DURATION_201505) as NO_LCALL_DURATION_201505
,to_number(PROV_LCALL_DURATION_201505) as PROV_LCALL_DURATION_201505
,to_number(NATIONAL_LCALL_DURATION_201505) as NATIONAL_LCALL_DURATION_201505
,to_number(INTERGAT_LCALL_DURATION_201505) as INTERGAT_LCALL_DURATION_201505
,to_number(NOINTERGATLCALLDURATION_201505) as NOINTERGATLCALLDURATION_201505
,to_number(ROAM_CALL_DURATION_201505) as ROAM_CALL_DURATION_201505
,to_number(BILL_DURATION_01_201505) as BILL_DURATION_01_201505
,to_number(CZ_FEE_01_201505) as CZ_FEE_01_201505
,to_number(CUR_INCOME_201505) as CUR_INCOME_201505
,to_number(PROM_FEE_201505) as PROM_FEE_201505
,to_number(DEBT_FEE_201505) as DEBT_FEE_201505
,to_number(NOT_PACKAGE_USE_201505_201505) as NOT_PACKAGE_USE_201505_201505
,to_number(FREE_FLOW_USE_201505) as FREE_FLOW_USE_201505
,to_number(ROAM_STREAM_01_201505) as ROAM_STREAM_01_201505
,to_number(ROAM_STREAM_02_201505) as ROAM_STREAM_02_201505
,to_number(ROAM_STREAM_04_201505) as ROAM_STREAM_04_201505
,to_number(VOICEOVER_TAG_201505) as VOICEOVER_TAG_201505
,to_number(SMS_NUMS_201505) as SMS_NUMS_201505
,to_number(USER_STATE_CODESET_20150531) as USER_STATE_CODESET_20150531
,to_number(USER_STATE_CODESET_20150515) as USER_STATE_CODESET_20150515
,to_number(USER_STATE_CODESET_20150430) as USER_STATE_CODESET_20150430
,to_number(LOST_TAG_5_T2) as LOST_TAG_5_T2
,to_number(tagof_stream) as tagof_stream
from uni_05mth_4g_tagof_stream_t2 where lost_tag_5_t2!=-1);

create table uni_06mth_4g_tagof_stream_t2 as select 
UNI_06MTH_ALL_4G.	EPARCHY_CODE_201506,
UNI_06MTH_ALL_4G.USER_ID,
UNI_06MTH_ALL_4G.	ID_1,
UNI_06MTH_ALL_4G.	ID_2,
UNI_06MTH_ALL_4G.	EPARCHY_TYPE_201506,
UNI_06MTH_ALL_4G.	ACTION_END_DATE_201506,
UNI_06MTH_ALL_4G.	CREDIT_VALUE_201506,
UNI_06MTH_ALL_4G.	JOIN_MONTH_201506,
UNI_06MTH_ALL_4G.	VOICE_TAG_201506,
UNI_06MTH_ALL_4G.	ROAM_TAG_03_201506,
UNI_06MTH_ALL_4G.	MTC_NUM_201506,
UNI_06MTH_ALL_4G.	NO_LCALL_DURATION_201506,
UNI_06MTH_ALL_4G.	PROV_LCALL_DURATION_201506,
UNI_06MTH_ALL_4G.	NATIONAL_LCALL_DURATION_201506,
UNI_06MTH_ALL_4G.	INTERGAT_LCALL_DURATION_201506,
UNI_06MTH_ALL_4G.	NOINTERGATLCALLDURATION_201506,
UNI_06MTH_ALL_4G.	ROAM_CALL_DURATION_201506,
UNI_06MTH_ALL_4G.	BILL_DURATION_01_201506,
UNI_06MTH_ALL_4G.	CZ_FEE_01_201506,
UNI_06MTH_ALL_4G.	CUR_INCOME_201506,
UNI_06MTH_ALL_4G.	PROM_FEE_201506,
UNI_06MTH_ALL_4G.	DEBT_FEE_201506,
UNI_06MTH_ALL_4G.	NOT_PACKAGE_USE_201506_201506,
UNI_06MTH_ALL_4G.	FREE_FLOW_USE_201506,
UNI_06MTH_ALL_4G.	ROAM_STREAM_01_201506,
UNI_06MTH_ALL_4G.	ROAM_STREAM_02_201506,
UNI_06MTH_ALL_4G.	ROAM_STREAM_04_201506,
UNI_06MTH_ALL_4G.	VOICEOVER_TAG_201506,
UNI_06MTH_ALL_4G.	SMS_NUMS_201506,
	ASIAINFO_USERSTCODESET_QX_5_4G.USER_STATE_CODESET_20150630,
	ASIAINFO_USERSTCODESET_QX_5_4G.USER_STATE_CODESET_20150615,
	ASIAINFO_USERSTCODESET_QX_5_4G.USER_STATE_CODESET_20150531,
ASIAINFO_MON_QX_6_4G.	LOST_TAG_201508,
ASIAINFO_MON_QX_6_4G.	LOST_TAG_201503,
ASIAINFO_MON_QX_6_4G.	LOST_TAG_201504,
ASIAINFO_MON_QX_6_4G.	LOST_TAG_201505,
ASIAINFO_MON_QX_6_4G.	LOST_TAG_201506,
ASIAINFO_MON_QX_6_4G.	LOST_TAG_201507,
ASIAINFO_MON_QX_6_4G.	join_month_201503,
UNI_05MTH_4G_TAGOF_STREAM.	total_stream_03,
UNI_05MTH_4G_TAGOF_STREAM.	total_stream_04,
UNI_05MTH_4G_TAGOF_STREAM.	total_stream_05,
UNI_05MTH_4G_TAGOF_STREAM.	total_stream_06

from UNI_06MTH_ALL_4G,ASIAINFO_USERSTCODESET_QX_5_4G,UNI_05MTH_4G_TAGOF_STREAM,ASIAINFO_MON_QX_6_4G
where UNI_06MTH_ALL_4G.user_id=ASIAINFO_USERSTCODESET_QX_5_4G.user_id AND UNI_05MTH_4G_TAGOF_STREAM.USER_ID=UNI_06MTH_ALL_4G.user_id
AND ASIAINFO_MON_QX_6_4G.USER_ID=UNI_05MTH_4G_TAGOF_STREAM.USER_ID;

update UNI_06MTH_4G_TAGOF_STREAM_T2 set USER_STATE_CODESET_20150630='3' where USER_STATE_CODESET_20150630='2';
update UNI_06MTH_4G_TAGOF_STREAM_T2 set USER_STATE_CODESET_20150630='2' where USER_STATE_CODESET_20150630='4';
update UNI_06MTH_4G_TAGOF_STREAM_T2 set USER_STATE_CODESET_20150630='4' where USER_STATE_CODESET_20150630='6';
update UNI_06MTH_4G_TAGOF_STREAM_T2 set USER_STATE_CODESET_20150630='7' where USER_STATE_CODESET_20150630='7';
update UNI_06MTH_4G_TAGOF_STREAM_T2 set USER_STATE_CODESET_20150630='5' where USER_STATE_CODESET_20150630='5';
update UNI_06MTH_4G_TAGOF_STREAM_T2 set USER_STATE_CODESET_20150630='6' where USER_STATE_CODESET_20150630='9';
update UNI_06MTH_4G_TAGOF_STREAM_T2 set USER_STATE_CODESET_20150630='2' where USER_STATE_CODESET_20150630='A';
update UNI_06MTH_4G_TAGOF_STREAM_T2 set USER_STATE_CODESET_20150630='3' where USER_STATE_CODESET_20150630='B';
update UNI_06MTH_4G_TAGOF_STREAM_T2 set USER_STATE_CODESET_20150630='4' where USER_STATE_CODESET_20150630='F';
update UNI_06MTH_4G_TAGOF_STREAM_T2 set USER_STATE_CODESET_20150630='2' where USER_STATE_CODESET_20150630='K';
update UNI_06MTH_4G_TAGOF_STREAM_T2 set USER_STATE_CODESET_20150630='5' where USER_STATE_CODESET_20150630='N';
update UNI_06MTH_4G_TAGOF_STREAM_T2 set USER_STATE_CODESET_20150630='5' where USER_STATE_CODESET_20150630='O';
update UNI_06MTH_4G_TAGOF_STREAM_T2 set USER_STATE_CODESET_20150630='5' where USER_STATE_CODESET_20150630='T';
update UNI_06MTH_4G_TAGOF_STREAM_T2 set USER_STATE_CODESET_20150630='6' where USER_STATE_CODESET_20150630='U';
update UNI_06MTH_4G_TAGOF_STREAM_T2 set USER_STATE_CODESET_20150630='5' where USER_STATE_CODESET_20150630='X';
update UNI_06MTH_4G_TAGOF_STREAM_T2 set USER_STATE_CODESET_20150630='5' where USER_STATE_CODESET_20150630='M';
update UNI_06MTH_4G_TAGOF_STREAM_T2 set USER_STATE_CODESET_20150630='5' where USER_STATE_CODESET_20150630='e';

update UNI_06MTH_4G_TAGOF_STREAM_T2 set USER_STATE_CODESET_20150615='3' where USER_STATE_CODESET_20150615='2';
update UNI_06MTH_4G_TAGOF_STREAM_T2 set USER_STATE_CODESET_20150615='2' where USER_STATE_CODESET_20150615='4';
update UNI_06MTH_4G_TAGOF_STREAM_T2 set USER_STATE_CODESET_20150615='4' where USER_STATE_CODESET_20150615='6';
update UNI_06MTH_4G_TAGOF_STREAM_T2 set USER_STATE_CODESET_20150615='7' where USER_STATE_CODESET_20150615='7';
update UNI_06MTH_4G_TAGOF_STREAM_T2 set USER_STATE_CODESET_20150615='5' where USER_STATE_CODESET_20150615='5';
update UNI_06MTH_4G_TAGOF_STREAM_T2 set USER_STATE_CODESET_20150615='6' where USER_STATE_CODESET_20150615='9';
update UNI_06MTH_4G_TAGOF_STREAM_T2 set USER_STATE_CODESET_20150615='2' where USER_STATE_CODESET_20150615='A';
update UNI_06MTH_4G_TAGOF_STREAM_T2 set USER_STATE_CODESET_20150615='3' where USER_STATE_CODESET_20150615='B';
update UNI_06MTH_4G_TAGOF_STREAM_T2 set USER_STATE_CODESET_20150615='4' where USER_STATE_CODESET_20150615='F';
update UNI_06MTH_4G_TAGOF_STREAM_T2 set USER_STATE_CODESET_20150615='2' where USER_STATE_CODESET_20150615='K';
update UNI_06MTH_4G_TAGOF_STREAM_T2 set USER_STATE_CODESET_20150615='5' where USER_STATE_CODESET_20150615='N';
update UNI_06MTH_4G_TAGOF_STREAM_T2 set USER_STATE_CODESET_20150615='5' where USER_STATE_CODESET_20150615='O';
update UNI_06MTH_4G_TAGOF_STREAM_T2 set USER_STATE_CODESET_20150615='5' where USER_STATE_CODESET_20150615='T';
update UNI_06MTH_4G_TAGOF_STREAM_T2 set USER_STATE_CODESET_20150615='6' where USER_STATE_CODESET_20150615='U';
update UNI_06MTH_4G_TAGOF_STREAM_T2 set USER_STATE_CODESET_20150615='5' where USER_STATE_CODESET_20150615='X';
update UNI_06MTH_4G_TAGOF_STREAM_T2 set USER_STATE_CODESET_20150615='5' where USER_STATE_CODESET_20150615='M';
update UNI_06MTH_4G_TAGOF_STREAM_T2 set USER_STATE_CODESET_20150615='5' where USER_STATE_CODESET_20150615='e';

update UNI_06MTH_4G_TAGOF_STREAM_T2 set USER_STATE_CODESET_20150531='3' where USER_STATE_CODESET_20150531='2';
update UNI_06MTH_4G_TAGOF_STREAM_T2 set USER_STATE_CODESET_20150531='2' where USER_STATE_CODESET_20150531='4';
update UNI_06MTH_4G_TAGOF_STREAM_T2 set USER_STATE_CODESET_20150531='4' where USER_STATE_CODESET_20150531='6';
update UNI_06MTH_4G_TAGOF_STREAM_T2 set USER_STATE_CODESET_20150531='7' where USER_STATE_CODESET_20150531='7';
update UNI_06MTH_4G_TAGOF_STREAM_T2 set USER_STATE_CODESET_20150531='5' where USER_STATE_CODESET_20150531='5';
update UNI_06MTH_4G_TAGOF_STREAM_T2 set USER_STATE_CODESET_20150531='6' where USER_STATE_CODESET_20150531='9';
update UNI_06MTH_4G_TAGOF_STREAM_T2 set USER_STATE_CODESET_20150531='2' where USER_STATE_CODESET_20150531='A';
update UNI_06MTH_4G_TAGOF_STREAM_T2 set USER_STATE_CODESET_20150531='3' where USER_STATE_CODESET_20150531='B';
update UNI_06MTH_4G_TAGOF_STREAM_T2 set USER_STATE_CODESET_20150531='4' where USER_STATE_CODESET_20150531='F';
update UNI_06MTH_4G_TAGOF_STREAM_T2 set USER_STATE_CODESET_20150531='2' where USER_STATE_CODESET_20150531='K';
update UNI_06MTH_4G_TAGOF_STREAM_T2 set USER_STATE_CODESET_20150531='5' where USER_STATE_CODESET_20150531='N';
update UNI_06MTH_4G_TAGOF_STREAM_T2 set USER_STATE_CODESET_20150531='5' where USER_STATE_CODESET_20150531='O';
update UNI_06MTH_4G_TAGOF_STREAM_T2 set USER_STATE_CODESET_20150531='5' where USER_STATE_CODESET_20150531='T';
update UNI_06MTH_4G_TAGOF_STREAM_T2 set USER_STATE_CODESET_20150531='6' where USER_STATE_CODESET_20150531='U';
update UNI_06MTH_4G_TAGOF_STREAM_T2 set USER_STATE_CODESET_20150531='5' where USER_STATE_CODESET_20150531='X';
update UNI_06MTH_4G_TAGOF_STREAM_T2 set USER_STATE_CODESET_20150531='5' where USER_STATE_CODESET_20150531='M';
update UNI_06MTH_4G_TAGOF_STREAM_T2 set USER_STATE_CODESET_20150531='5' where USER_STATE_CODESET_20150531='e';

alter table UNI_06MTH_4G_TAGOF_STREAM_T2 add lost_TAG_6_T2 number;
update UNI_06MTH_4G_TAGOF_STREAM_T2 set lost_TAG_6_T2=-1;
update UNI_06MTH_4G_TAGOF_STREAM_T2 set lost_TAG_6_T2=0 where
(LOST_TAG_201503=0 and 
LOST_TAG_201504=0 and 
LOST_TAG_201505=0 and 
LOST_TAG_201506=0 and 
LOST_TAG_201507=0 and 
LOST_TAG_201508=0) or 
(LOST_TAG_201503=2 and 
LOST_TAG_201504=0 and 
LOST_TAG_201505=0 and 
LOST_TAG_201506=0 and 
LOST_TAG_201507=0 and 
LOST_TAG_201508=0) or 
(LOST_TAG_201503=2 and 
LOST_TAG_201504=2 and 
LOST_TAG_201505=0 and 
LOST_TAG_201506=0 and 
LOST_TAG_201507=0 and 
LOST_TAG_201508=0);
update UNI_06MTH_4G_TAGOF_STREAM_T2 set lost_TAG_6_T2=1 where
(LOST_TAG_201503=0 and 
LOST_TAG_201504=0 and 
LOST_TAG_201505=0 and 
LOST_TAG_201506=0 and 
LOST_TAG_201507=0 and 
LOST_TAG_201508=1) or 
(LOST_TAG_201503=2 and 
LOST_TAG_201504=0 and 
LOST_TAG_201505=0 and 
LOST_TAG_201506=0 and 
LOST_TAG_201507=0 and 
LOST_TAG_201508=1) or 
(LOST_TAG_201503=2 and 
LOST_TAG_201504=2 and 
LOST_TAG_201505=0 and 
LOST_TAG_201506=0 and 
LOST_TAG_201507=0 and 
LOST_TAG_201508=1);

alter table uni_06mth_4g_tagof_stream_t2 add tagof_stream number;
update uni_06mth_4g_tagof_stream_t2 set tagof_stream=0;
update uni_06mth_4g_tagof_stream_t2 set tagof_stream=1
where 
join_month_201503>=0 and
(case when total_stream_05=0 then 1 else 0 end +
case when total_stream_06=0 then 1 else 0 end +
case when total_stream_03=0 then 1 else 0 end +
case when total_stream_04=0 then 1 else 0 end )>=2;

create table yuanshishuju_4g_6_stream_t2 as (select
to_number(EPARCHY_CODE_201506) as EPARCHY_CODE_201506
,to_number(USER_ID) as USER_ID
,to_number(ID_1) as ID_1
,to_number(ID_2) as ID_2
,to_number(EPARCHY_TYPE_201506) as EPARCHY_TYPE_201506
,to_number(ACTION_END_DATE_201506) as ACTION_END_DATE_201506
,to_number(CREDIT_VALUE_201506) as CREDIT_VALUE_201506
,to_number(JOIN_MONTH_201506) as JOIN_MONTH_201506
,to_number(ROAM_TAG_03_201506) as ROAM_TAG_03_201506
,to_number(MTC_NUM_201506) as MTC_NUM_201506
,to_number(NO_LCALL_DURATION_201506) as NO_LCALL_DURATION_201506
,to_number(PROV_LCALL_DURATION_201506) as PROV_LCALL_DURATION_201506
,to_number(NATIONAL_LCALL_DURATION_201506) as NATIONAL_LCALL_DURATION_201506
,to_number(INTERGAT_LCALL_DURATION_201506) as INTERGAT_LCALL_DURATION_201506
,to_number(NOINTERGATLCALLDURATION_201506) as NOINTERGATLCALLDURATION_201506
,to_number(ROAM_CALL_DURATION_201506) as ROAM_CALL_DURATION_201506
,to_number(BILL_DURATION_01_201506) as BILL_DURATION_01_201506
,to_number(CZ_FEE_01_201506) as CZ_FEE_01_201506
,to_number(CUR_INCOME_201506) as CUR_INCOME_201506
,to_number(PROM_FEE_201506) as PROM_FEE_201506
,to_number(DEBT_FEE_201506) as DEBT_FEE_201506
,to_number(NOT_PACKAGE_USE_201506_201506) as NOT_PACKAGE_USE_201506_201506
,to_number(FREE_FLOW_USE_201506) as FREE_FLOW_USE_201506
,to_number(ROAM_STREAM_01_201506) as ROAM_STREAM_01_201506
,to_number(ROAM_STREAM_02_201506) as ROAM_STREAM_02_201506
,to_number(ROAM_STREAM_04_201506) as ROAM_STREAM_04_201506
,to_number(VOICEOVER_TAG_201506) as VOICEOVER_TAG_201506
,to_number(SMS_NUMS_201506) as SMS_NUMS_201506
,to_number(USER_STATE_CODESET_20150630) as USER_STATE_CODESET_20150630
,to_number(USER_STATE_CODESET_20150615) as USER_STATE_CODESET_20150615
,to_number(USER_STATE_CODESET_20150531) as USER_STATE_CODESET_20150531
,to_number(LOST_TAG_6_T2) as LOST_TAG_6_T2
,to_number(tagof_stream) as tagof_stream
from uni_06mth_4g_tagof_stream_t2 where lost_TAG_6_t2!=-1);
